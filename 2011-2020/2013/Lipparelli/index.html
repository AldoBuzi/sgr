<!DOCTYPE html>
<html>
	<head>
		<title>Cron Research</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link rel="shortcut icon" href="img/icon_clock.png"/>
		<link href="css/bootstrap.css" rel="stylesheet"/>
		<link href="css/font-awesome.css" rel="stylesheet"/>
		<link href="css/bootstrap-timepicker.min.css" rel="stylesheet"/>
		<link href="css/datepicker.css" rel="stylesheet"/>
		<script type="text/javascript" src="js/jquery-1.10.1.js"></script>
		<script type="text/javascript" src="js/bootstrap.js"></script>
		<script type="text/javascript" src="js/bootstrap-timepicker.min.js"></script>
		<script type="text/javascript" src="js/bootstrap-datepicker.js"></script>
		<script type="text/javascript" src="js/d3.v3.js"></script>
		<style type="text/css">
			#infoDiv{
				height: 120px;
				overflow: auto;
				resize: vertical;
			}
		</style>
	</head>

	<body>
		<div class="container-narrow">
			<!-- Option Modal -->
			<div id="optModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h3 id="myModalLabel">Options</h3>
				</div>
				<div class="modal-body">
					<div class="tabbable">
						<ul class="nav nav-tabs">
							<li class="active"><a href="#genOptTab" data-toggle="tab">General Options</a></li>
							<li><a href="#othOptTab" data-toggle="tab">Other Options</a></li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="genOptTab">
								<form class="form-horizontal">
									<fieldset>
										<div class="control-group">
										<label class="control-label">Option 1</label>  
											<div class="controls">  
												<div class="btn-group" data-toggle="buttons-radio" id="optEntry1">
													<button type="button" class="btn" data-value="0"><span class="add-on"><i class="icon-ok"></i></span></button>
													<button type="button" class="btn active" data-value="1"><span class="add-on"><i class="icon-remove"></i></span></button>
												</div>  
											</div>  
										</div>
									</fieldset>
								</form>
							</div>
							<div class="tab-pane" id="othOptTab">
								<p>One day here will be some Options...maybe :)</p>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Close</button>
					<button class="btn btn-primary" id="saveOpt">Save changes</button>
				</div>
			</div>

			<!-- Wellcome Modal -->
			<div id="wellcomeModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h3 id="myModalLabel">Cron Research</h3>
				</div>
				<div class="modal-body">
					<div class="span6">
						<p class="text-left">
							<em>Cron Reasearch is a D3 Display Data researcher for The Historical Archive generated by ntopng. For more information about the use and Me, check the documentation section (the book icon in the end of navigation bar).</em>
						</p>
						
						<p>
							<em>This project it's The Final Term for course of Gestione di Rete (Networking Management) of University of Pisa</em>
						</p>
						</br>
						
						<ul class="thumbnails span5 pull-left  offset1">
						<li>
							<a href="http://www.ntop.org" class="thumbnail">
								<img src="img/logo_ntopng_cron.png" alt="" width="160" height="80" />
							</a>
						</li>
						<li>
							<a href="http://www.di.unipi.it/" class="thumbnail">
								<img src="img/Unipi.jpg" alt="" width="160" height="160" />
							</a>
						</li>
						</ul>
					</div>
				</div>
				<div class="modal-footer">
					<p>Produced and Developed By David Lipparelli © 2013</p>
				</div>
			</div>

			<div id="srchDiv" class="container-narrow">
				<div class="bs-docs-example">
					<div class="navbar">
						<div class="navbar-inner">
							<div class="container">
								<a class="brand" href="#wellcomeModal" data-toggle="modal" data-target"#wellcomeModal">Cron Research</a>
								<div class="nav-collapse collapse navbar-responsive-collapse">
									<form class="navbar-form pull-left form-inline">
										<div class="input-append date">
											<input id="datepicker1" class="input" type="text" placeholder="dd/mm/yyyy">
											<span class="add-on"><i class="icon-calendar"></i></span>
										</div>
										<div class="input-append bootstrap-timepicker">
											<input id="timepicker1" type="text" class="input" placeholder="hh:mm">
											<span class="add-on"><i class="icon-time"></i></span>
										</div>
										<button class="btn btn-primary" type="button" id="srchBtn">Search</button>
										<button class="btn btn-inverse" type="button" id="popOnDbBtn">Populating DB Mode</button>
									</form>	
									<ul class="nav pull-right">
										<li>
											<a href="#optModal" data-toggle="modal" data-target="#optModal"><span class="add-on"><i class="icon-cog"></i></span></a>
										</li>
										<li class="dropdown">
											<a class="dropdown-toggle" href="#" data-toggle="dropdown"><span class="add-on"><i class="icon-book"></i></span><b class="caret"></b></a>
											<ul class="dropdown-menu">
												<li>
													<a href="/about_the_author.html">About The Author</a>
												</li>
												<li>
													<a href="http://compass2.di.unipi.it/didattica/wti/share/corsi/corso.asp?id=2610&cds=wti&anno=2007">About The Course</a>
												</li>
												<li>
													<a href="http://luca.ntop.org">About The Teacher and Ntop</a>
												</li>
												<li>
													<a href="/more_info.html">More Info</a>
												</li>
											</ul>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					<!--Populate Mode-->
					<div id="popDbDiv" class="container">
						<div class="alert alert-block">
							<button type="button" class="close" data-dismiss="alert">&times;</button>
							<h4>Warning!</h4>You're going to populate the Database, it take much time and the process CANNOT be stopped!!</br></br><h4>Advice:</h4> Populate the Database with small time intervals like 1 or at maximum 20 minutes, so repeated.
						</div>
						<form class="form-inline" id="popDbForm">
							<strong>Select time period from</strong>
							<div class="input-append date">
								<input id="datepicker2" class="input-small" type="text" placeholder="dd/mm/yyyy">
								<span class="add-on"><i class="icon-calendar"></i></span>
							</div>
							<div class="input-append bootstrap-timepicker">
								<input id="timepicker2" type="text" class="input-small" placeholder="hh:mm">
								<span class="add-on"><i class="icon-time"></i></span>
							</div>
							<strong>to</strong>
							<div class="input-append date">
								<input id="datepicker3" class="input-small" type="text" placeholder="dd/mm/yyyy">
								<span class="add-on"><i class="icon-calendar"></i></span>
							</div>
							<div class="input-append bootstrap-timepicker">
								<input id="timepicker3" type="text" class="input-small" placeholder="hh:mm">
								<span class="add-on"><i class="icon-time"></i></span>
							</div>
							<strong> and press </strong>
							<button class="btn btn-success" type="button" id="popDbBtn">Populate DB</button>
						</form>
						<div id="popSpinner" class="container">
							<span><i class="icon-spinner icon-spin icon-large" ></i> <strong>Wait, I am populating the Database...<strong><span>
						</div>
					</div>
				</div>
			</div>
			<div class="container">
				<h2>Results Table</h2>
				<div class="bs-docs-example" id="infoDiv">
					
					<table class="table table-bordered table-striped" id="infoTable">
						<thead>
							<th>Second</th>
							<th>Top Host IP</th>
							<th>Traffic Type</th>
							<th>Traffic (Bytes)</th>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
			</div>
			<div class="row-fluid" id="respDiv">
			</div>
		</div>

		<script type="text/javascript">
			var popModeOn = 0, onPop = 0, prog_req = "update";
			$('#datepicker1').datepicker({
				format: 'dd/mm/yyyy'
			});

			$('#datepicker2').datepicker({
				format: 'dd/mm/yyyy'
			});

			$('#datepicker3').datepicker({
				format: 'dd/mm/yyyy'
			});

			$('#timepicker1').timepicker({
				minuteStep: 1,
				showSeconds: false,
				showMeridian: false
			});

			$('#timepicker2').timepicker({
				minuteStep: 1,
				showSeconds: false,
				showMeridian: false
			});

			$('#timepicker3').timepicker({
				minuteStep: 1,
				showSeconds: false,
				showMeridian: false
			});

			$(document).ready(function(){
				$('#popDbDiv').hide();
				$('#popSpinner').hide();
				$('#srchBtn').click(function(){
					$('#respDiv').remove();
					$('#infoTable').remove();
					$('svg').empty();
					$('svg').remove();
					var data = $('#datepicker1').val(), time = $('#timepicker1').val();
					var data_s = data.split("/");
					var time_s = time.split(":");
					var url = data_s[2] + "-" + data_s[1] + "-" + data_s[0] + "-" + time_s[0] + "-" + time_s[1];
					$('body').append('<div class="row-fluid" id="respDiv"><div class="span4"></div></div>');
					$('#respDiv').load("searchRequest.php",{url: url});
					$('#infoDiv').append('<table class="table table-bordered table-striped" id="infoTable"><thead><th>Second</th><th>Top Host IP</th><th>Traffic Type</th><th>Traffic (Bytes)</th></thead><tbody></tbody></table>');
				});

				$('#popOnDbBtn').click(function() {
					if(popModeOn==0){
						popModeOn=1;
						$('#popDbDiv').show();
						$('#srchBtn').attr("disabled","disabled");
						$('#datepicker1').attr("disabled","disabled");
						$('#timepicker1').attr("disabled","disabled");
					}else{
						popModeOn=0;
						$('#popDbDiv').hide();
						$('#srchBtn').removeAttr("disabled");
						$('#datepicker1').removeAttr("disabled");
						$('#timepicker1').removeAttr("disabled");
					}
				});

				$('#popDbBtn').click(function(){
					var data2 = $('#datepicker2').val(), time2 = $('#timepicker2').val();
					var data_s2 = data2.split("/");
					var time_s2 = time2.split(":");
					var url2 = time_s2[0] + "-" + time_s2[1] + "-" + data_s2[1] + "-" + data_s2[0] + "-" + data_s2[2];

					var data3 = $('#datepicker3').val(), time3 = $('#timepicker3').val();
					var data_s3 = data3.split("/");
					var time_s3 = time3.split(":");
					var url3 = time_s3[0] + "-" + time_s3[1] + "-" + data_s3[1] + "-" + data_s3[0] + "-" + data_s3[2];

					var request = $.ajax({url:"popDB.php", type:"POST", data:{date1: url2, date2:url3}, timeout:3000000});
					request.done(function(data){
						$('#popSpinner').hide();
						$('#popDbForm').show();
						$('#popDbDiv').append(data);
					});

					$('#popDbForm').hide();
					$('#popSpinner').show();
				});
			});
		</script>
	</body>
</html>
